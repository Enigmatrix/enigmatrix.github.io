<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DSO NUS 2021 CTF - SOAR (Reverse) | Enigmatrix</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="I really, really don't want to reverse this ;-;">
    
    <link rel="preload" href="/assets/css/0.styles.d518fe33.css" as="style"><link rel="preload" href="/assets/js/app.c3d8ca62.js" as="script"><link rel="preload" href="/assets/js/6.3722ae10.js" as="script"><link rel="preload" href="/assets/js/3.8eed2eee.js" as="script"><link rel="preload" href="/assets/js/20.00359bb3.js" as="script"><link rel="prefetch" href="/assets/js/10.4b595a00.js"><link rel="prefetch" href="/assets/js/11.fb3a3275.js"><link rel="prefetch" href="/assets/js/12.e01f3506.js"><link rel="prefetch" href="/assets/js/13.c3ff054c.js"><link rel="prefetch" href="/assets/js/14.cbc77de8.js"><link rel="prefetch" href="/assets/js/15.12185247.js"><link rel="prefetch" href="/assets/js/16.ff9fde79.js"><link rel="prefetch" href="/assets/js/17.c2e9ae64.js"><link rel="prefetch" href="/assets/js/18.b31259ba.js"><link rel="prefetch" href="/assets/js/19.9ea997bf.js"><link rel="prefetch" href="/assets/js/21.1cc8c958.js"><link rel="prefetch" href="/assets/js/4.5f78fef9.js"><link rel="prefetch" href="/assets/js/5.98a0c27e.js"><link rel="prefetch" href="/assets/js/7.ff10d07c.js"><link rel="prefetch" href="/assets/js/8.e129988e.js"><link rel="prefetch" href="/assets/js/9.868a262b.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.92caeb0c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d518fe33.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="root" class="theme-container no-sidebar" data-v-4533fcd8><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Enigmatrix</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div><div class="nav-item"><a href="/tags/" class="nav-link">
  Tags
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div><div class="nav-item"><a href="/tags/" class="nav-link">
  Tags
</a></div> <!----></nav>  <!----> </aside> <main class="page"><div id="post-header" class="theme-default-content" data-v-4533fcd8><div id="date" data-v-4533fcd8>16 March 2021, 10:55 pm</div> <h1 id="title" data-v-4533fcd8>DSO NUS 2021 CTF - SOAR (Reverse)</h1> <span id="description" data-v-4533fcd8>I really, really don't want to reverse this ;-;</span> <div id="tags" data-v-4533fcd8><a href="/tags/ctf" class="tag" data-v-4533fcd8>ctf</a><a href="/tags/dso-nus-ctf" class="tag" data-v-4533fcd8>dso-nus-ctf</a><a href="/tags/rev" class="tag" data-v-4533fcd8>rev</a></div></div> <div class="theme-default-content content__default"><p>This challenge was a fun one since I did not really 'solve' it. I bruteforced my way through by using <a href="https://github.com/qilingframework/qiling" target="_blank" rel="noopener noreferrer">Qiling<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>We are handed a PDF File called <code>SOAR-challenge.pdf</code>. Opening it up, we see a advertisement for DSO (<em>organizers, that's a very smart way to do it!</em>), but nothing else very interesting. I thought it was unusual for a challenge to be in the <strong>reversing</strong> category but not offer anything to really reverse, so I peeked deeper into the file using <code>binwalk</code>, thinking that were probably embedded files in the pdf:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>‚ùØ binwalk SOAR-challenge.pdf

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
<span class="token number">0</span>             0x0             PDF document, version: <span class="token string">&quot;1.4&quot;</span>
<span class="token number">70</span>            0x46            Zip archive data, at least v2.0 to extract, compressed size: <span class="token number">4729</span>, uncompressed size: <span class="token number">4760</span>, name: soar.zip
<span class="token number">40792</span>         0x9F58          End of Zip archive, footer length: <span class="token number">22</span>
</code></pre></div><p>Extracing the files:</p> <div class="language- extra-class"><pre class="language-text"><code>binwalk -e SOAR-challenge.pdf
</code></pre></div><p>The generated <code>_SOAR-challenge.pdf.extracted</code> folder has this structure:</p> <div class="language- extra-class"><pre class="language-text"><code>&gt; _SOAR-challenge.pdf.extracted
    &gt; 46.zip
    &gt; soar.zip
</code></pre></div><p>Opening up the <code>soar.zip</code> file, we see that it has one file inside, called <code>soar</code>. However, we cannot extract the file out as the zip is password protected. I threw the zip file into an <a href="https://www.lostmypass.com/" target="_blank" rel="noopener noreferrer">online zip password <em>recovery</em> (ahem: <strong>cracking</strong>) service<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, and got the <code>soar</code> file. The password was <strong>dso</strong>, very appropriate.</p> <h2 id="initial-analysis"><a href="#initial-analysis" class="header-anchor">#</a> Initial Analysis</h2> <p>Running the <code>soar</code> binary gives no output, so I opened up the file in <a href="">Ghidra</a>.</p> <div class="language-c extra-class"><pre class="language-c"><code>
<span class="token comment">// WARNING: Removing unreachable block (ram,0x00101c99)</span>
<span class="token comment">// WARNING: Could not reconcile some variable overlaps</span>

undefined8 <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>

<span class="token punctuation">{</span>
  
  bVar14 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  local_10 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>in_FS_OFFSET <span class="token operator">+</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  local_690 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0xd50c51</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mem_i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  local_6b0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  local_6a8 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  mem <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0xd50c51</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mem_i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>mem_i <span class="token operator">&lt;</span> <span class="token number">0xd50c52</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>undefined <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>mem <span class="token operator">+</span> mem_i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    mem_i <span class="token operator">=</span> mem_i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  mem_i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>mem_i <span class="token operator">&lt;</span> <span class="token number">0xd50c52</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>mem <span class="token operator">+</span> mem_i<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'\0'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      local_6b0 <span class="token operator">=</span> mem_i <span class="token operator">*</span> mem_i<span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_6b0 <span class="token operator">&lt;</span> <span class="token number">0xd50c51</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">*</span><span class="token punctuation">(</span>undefined <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>mem <span class="token operator">+</span> local_6b0<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        local_6b0 <span class="token operator">=</span> local_6b0 <span class="token operator">+</span> mem_i<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    mem_i <span class="token operator">=</span> mem_i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">time</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>local_6c0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  CURRENT_TIME <span class="token operator">=</span> <span class="token function">localtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>local_6c0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  uVar9 <span class="token operator">=</span> CURRENT_TIME<span class="token operator">-&gt;</span>tm_min<span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x36</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x26</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x18</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xb</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x24</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x11</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x12</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x10</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x1f</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x28</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x33</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x23</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x1e</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x16</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x2f</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x37</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xd</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x25</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x2c</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x21</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x14</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x15</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xc</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x1a</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x30</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x1c</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x1d</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xe</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">29</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x19</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x2e</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x17</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x31</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x34</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x29</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x39</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x13</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x32</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x2a</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x2d</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x35</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x38</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x1b</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x2b</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">44</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x27</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x22</span><span class="token punctuation">;</span>
  buffer<span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xf</span><span class="token punctuation">;</span>
  local_5ac <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  lVar8 <span class="token operator">=</span> <span class="token number">0x30</span><span class="token punctuation">;</span>
  plVar10 <span class="token operator">=</span> <span class="token operator">&amp;</span>DAT_00102040<span class="token punctuation">;</span>
  plVar12 <span class="token operator">=</span> local_398<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>lVar8 <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lVar8 <span class="token operator">=</span> lVar8 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>plVar12 <span class="token operator">=</span> <span class="token operator">*</span>plVar10<span class="token punctuation">;</span>
    plVar10 <span class="token operator">=</span> plVar10 <span class="token operator">+</span> <span class="token punctuation">(</span>ulong<span class="token punctuation">)</span>bVar14 <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    plVar12 <span class="token operator">=</span> plVar12 <span class="token operator">+</span> <span class="token punctuation">(</span>ulong<span class="token punctuation">)</span>bVar14 <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  local_690<span class="token punctuation">[</span><span class="token number">0x2f</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>
  mem_i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>mem_i <span class="token operator">&lt;</span> <span class="token number">0x2f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    local_398<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span> <span class="token operator">=</span> local_398<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">0x1a000</span><span class="token punctuation">;</span>
    local_398<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span> <span class="token operator">=</span> local_398<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">0xc51</span><span class="token punctuation">;</span>
    local_398<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span> <span class="token operator">=</span> local_398<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>local_220 <span class="token operator">+</span> <span class="token number">5U</span> <span class="token operator">^</span> uVar9<span class="token punctuation">)</span><span class="token punctuation">;</span>
    local_690<span class="token punctuation">[</span>buffer<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>local_220 <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>local_398<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    mem_i <span class="token operator">=</span> mem_i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  mem_i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  local_678 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>local_690<span class="token punctuation">,</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>local_678 <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fseek</span><span class="token punctuation">(</span>local_678<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lVar8 <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>local_678<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mem_i <span class="token operator">=</span> <span class="token punctuation">(</span>ulong<span class="token punctuation">)</span><span class="token punctuation">(</span>lVar8 <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>local_5ac <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>local_220 <span class="token operator">^</span> uVar9<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x18ce6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>local_678<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  iVar2 <span class="token operator">=</span> CURRENT_TIME<span class="token operator">-&gt;</span>tm_hour<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>mem_i <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    local_6a0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>local_6a0 <span class="token operator">&lt;</span> <span class="token number">0xd50c51</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>mem <span class="token operator">+</span> local_6a0<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'\0'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        local_670 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x2a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lVar8 <span class="token operator">=</span> local_6a0<span class="token punctuation">;</span>
        local_6cc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>local_6a0<span class="token punctuation">;</span>
        local_6b0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        lVar4 <span class="token operator">=</span> local_6b0<span class="token punctuation">;</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
          local_6b0 <span class="token operator">=</span> lVar4<span class="token punctuation">;</span>
          bVar3 <span class="token operator">=</span> <span class="token punctuation">(</span>byte<span class="token punctuation">)</span><span class="token punctuation">(</span>local_6cc <span class="token operator">&gt;&gt;</span> <span class="token number">0x37</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          uVar9 <span class="token operator">=</span> <span class="token punctuation">(</span>uint<span class="token punctuation">)</span><span class="token punctuation">(</span>local_6cc <span class="token operator">&gt;&gt;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">0x1c</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>local_6cc <span class="token operator">+</span> uVar9 <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">)</span> <span class="token operator">-</span> uVar9<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cVar5 <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token punctuation">{</span>
            cVar5 <span class="token operator">=</span> <span class="token string">'W'</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token operator">*</span><span class="token punctuation">(</span>byte <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_670 <span class="token operator">+</span> local_6b0<span class="token punctuation">)</span> <span class="token operator">=</span>
               <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>local_6cc <span class="token operator">+</span> <span class="token punctuation">(</span>bVar3 <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>bVar3 <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> cVar5<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>local_6cc <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            local_6cc <span class="token operator">=</span> local_6cc <span class="token operator">+</span> <span class="token number">0xf</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          local_6cc <span class="token operator">=</span> local_6cc <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">;</span>
          lVar4 <span class="token operator">=</span> local_6b0 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>local_6cc <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iVar6 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>local_6b0<span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span>undefined <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_670 <span class="token operator">+</span> local_6b0 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        local_6a0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        local_6b0 <span class="token operator">=</span> <span class="token function">SEXT48</span><span class="token punctuation">(</span>iVar6<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>local_6a0 <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_6b0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          uVar1 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>undefined <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_670 <span class="token operator">+</span> local_6a0<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token operator">*</span><span class="token punctuation">(</span>undefined <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_670 <span class="token operator">+</span> local_6a0<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>undefined <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_670 <span class="token operator">+</span>local_6b0<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token operator">*</span><span class="token punctuation">(</span>undefined <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_670 <span class="token operator">+</span> local_6b0<span class="token punctuation">)</span> <span class="token operator">=</span> uVar1<span class="token punctuation">;</span>
          local_6a0 <span class="token operator">=</span> local_6a0 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
          local_6b0 <span class="token operator">=</span> local_6b0 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        local_698 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>local_698 <span class="token operator">&lt;</span> iVar6 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          local_690<span class="token punctuation">[</span>local_6a8<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>local_698 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_670<span class="token punctuation">)</span><span class="token punctuation">;</span>
          local_698 <span class="token operator">=</span> local_698 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
          local_6a8 <span class="token operator">=</span> local_6a8 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        local_690<span class="token punctuation">[</span>local_6a8<span class="token punctuation">]</span> <span class="token operator">=</span> local_690<span class="token punctuation">[</span>local_6a8<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'C'</span><span class="token punctuation">;</span>
        local_690<span class="token punctuation">[</span>local_6a8 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> local_690<span class="token punctuation">[</span>local_6a8 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        local_690<span class="token punctuation">[</span>local_6a8 <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> local_690<span class="token punctuation">[</span>local_6a8 <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'L'</span><span class="token punctuation">;</span>
        local_690<span class="token punctuation">[</span>local_6a8 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'S'</span><span class="token punctuation">;</span>
        local_6a8 <span class="token operator">=</span> local_6a8 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>
        local_6a0 <span class="token operator">=</span> lVar8<span class="token punctuation">;</span>
        <span class="token function">free</span><span class="token punctuation">(</span>local_670<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      local_6a0 <span class="token operator">=</span> local_6a0 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  lVar8 <span class="token operator">=</span> <span class="token number">0x41</span><span class="token punctuation">;</span>
  plVar10 <span class="token operator">=</span> <span class="token operator">&amp;</span>DAT_001021c0<span class="token punctuation">;</span>
  plVar12 <span class="token operator">=</span> local_218<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>lVar8 <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lVar8 <span class="token operator">=</span> lVar8 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>plVar12 <span class="token operator">=</span> <span class="token operator">*</span>plVar10<span class="token punctuation">;</span>
    plVar10 <span class="token operator">=</span> plVar10 <span class="token operator">+</span> <span class="token punctuation">(</span>ulong<span class="token punctuation">)</span>bVar14 <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    plVar12 <span class="token operator">=</span> plVar12 <span class="token operator">+</span> <span class="token punctuation">(</span>ulong<span class="token punctuation">)</span>bVar14 <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  lVar8 <span class="token operator">=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>
  puVar11 <span class="token operator">=</span> <span class="token operator">&amp;</span>DAT_001023e0<span class="token punctuation">;</span>
  puVar13 <span class="token operator">=</span> local_4a8<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>lVar8 <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lVar8 <span class="token operator">=</span> lVar8 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>puVar13 <span class="token operator">=</span> <span class="token operator">*</span>puVar11<span class="token punctuation">;</span>
    puVar11 <span class="token operator">=</span> puVar11 <span class="token operator">+</span> <span class="token punctuation">(</span>ulong<span class="token punctuation">)</span>bVar14 <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    puVar13 <span class="token operator">=</span> puVar13 <span class="token operator">+</span> <span class="token punctuation">(</span>ulong<span class="token punctuation">)</span>bVar14 <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token operator">*</span><span class="token punctuation">(</span>undefined4 <span class="token operator">*</span><span class="token punctuation">)</span>puVar13 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>undefined4 <span class="token operator">*</span><span class="token punctuation">)</span>puVar11<span class="token punctuation">;</span>
  mem_i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>mem_i <span class="token operator">&lt;</span> <span class="token number">0x40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_4a8 <span class="token operator">+</span> mem_i <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">-</span> iVar2 <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      iVar6 <span class="token operator">=</span> iVar2 <span class="token operator">-</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_4a8 <span class="token operator">+</span> mem_i <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      iVar6 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_4a8 <span class="token operator">+</span> mem_i <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">-</span> iVar2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_4a8 <span class="token operator">+</span> mem_i <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">-</span> iVar2 <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      iVar7 <span class="token operator">=</span> iVar2 <span class="token operator">-</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_4a8 <span class="token operator">+</span> mem_i <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      iVar7 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>local_4a8 <span class="token operator">+</span> mem_i <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">-</span> iVar2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    aiStack1448<span class="token punctuation">[</span><span class="token punctuation">(</span>ulong<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>iVar7 <span class="token operator">%</span> <span class="token number">0x41</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>local_690<span class="token punctuation">[</span>local_218<span class="token punctuation">[</span><span class="token punctuation">(</span>ulong<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>iVar6 <span class="token operator">%</span><span class="token number">0x41</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    mem_i <span class="token operator">=</span> mem_i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  mem_i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>mem_i <span class="token operator">&lt;</span> <span class="token number">0x40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mem_i <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      local_690<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>aiStack1448<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>mem_i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        local_6b0 <span class="token operator">=</span> mem_i<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>iVar2 <span class="token operator">==</span> local_3a8 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>local_18<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
         <span class="token punctuation">(</span>local_690<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>aiStack1448<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span><span class="token punctuation">,</span> mem_i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        local_6b0 <span class="token operator">=</span> local_6b0 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    mem_i <span class="token operator">=</span> mem_i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  local_690<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>fStr <span class="token operator">+</span> local_6b0 <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>local_690<span class="token punctuation">,</span>local_690<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>local_10 <span class="token operator">==</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>in_FS_OFFSET <span class="token operator">+</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
                    <span class="token comment">// WARNING: Subroutine does not return</span>
  <span class="token function">__stack_chk_fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Well, that's a lot of code. I was playing in this competition solo, so I was too lazy to properly reverse it at that time. Instead, I wrote a script that would solve it in the background for me, while I worked on other challenges in the foreground. But, to even write a script to bruteforce our way though, we need to find out what is variable (modifiable by us here), as it looks like this program takes no input.</p> <h2 id="looking-a-bit-deeper"><a href="#looking-a-bit-deeper" class="header-anchor">#</a> Looking a bit deeper</h2> <p>The program takes in the current time via</p> <div class="language-c extra-class"><pre class="language-c"><code>  CURRENT_TIME <span class="token operator">=</span> <span class="token function">localtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>local_6c0<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>but only uses the <code>tm_min</code> and <code>tm_hour</code> fields</p> <div class="language-c extra-class"><pre class="language-c"><code>  uVar9 <span class="token operator">=</span> CURRENT_TIME<span class="token operator">-&gt;</span>tm_min<span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  iVar2 <span class="token operator">=</span> CURRENT_TIME<span class="token operator">-&gt;</span>tm_hour<span class="token punctuation">;</span>
</code></pre></div><p>Furthermore, it opens a file, but only reads in it's file size, then compares it with another number. This number might be a derivative of <code>tm_min</code>, since the code before this uses <code>tm_min</code>, but we are not sure yet.</p> <div class="language-c extra-class"><pre class="language-c"><code>  mem_i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  local_678 <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>local_690<span class="token punctuation">,</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// open file</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>local_678 <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment">// if exists...</span>
    <span class="token function">fseek</span><span class="token punctuation">(</span>local_678<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// seek to the end</span>
    lVar8 <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>local_678<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// get the position of the current seek,</span>
                                    <span class="token comment">// which is the end of the file,</span>
                                    <span class="token comment">// effectively giving us the length of the file</span>
    mem_i <span class="token operator">=</span> <span class="token punctuation">(</span>ulong<span class="token punctuation">)</span><span class="token punctuation">(</span>lVar8 <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>local_5ac <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>local_220 <span class="token operator">^</span> uVar9<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x18ce6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// compare it with this</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>local_678<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// close back file</span>
  <span class="token punctuation">}</span>
  iVar2 <span class="token operator">=</span> CURRENT_TIME<span class="token operator">-&gt;</span>tm_hour<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>mem_i <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                 <span class="token comment">// mem_i is either 0 or non-zero here</span>
                                    <span class="token comment">// after this comparison, mem_i is overwritten</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>In the end, a printf-formatted string is printed out. We can surmise that <code>local_690</code> is a char array, since the end has a null byte, and thus that the format string has a <code>%s</code> format specifier.</p> <div class="language-c extra-class"><pre class="language-c"><code>  local_690<span class="token punctuation">[</span>mem_i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>fStr <span class="token operator">+</span> local_6b0 <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>local_690<span class="token punctuation">,</span>local_690<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>So our variables are: the <code>tm_min</code> and <code>tm_hour</code> fields of the <code>tm</code> struct returned by <code>localtime()</code>, and the size of a file (that we do not know the name of).</p> <h2 id="solution"><a href="#solution" class="header-anchor">#</a> Solution</h2> <p>We have to iterate through all possible <code>tm_min</code> (0-60) and <code>tm_hour</code> (0-24) values.</p> <p>As for the file, we don't even need to know it's name or file size! Note that the variables used, <code>lVar8</code> (size of file) and <code>local_678</code> (file pointer) are overwritten afterwards, and they only serve to set <code>mem_i</code> to either 0 or 1 (the result of the comparison with a number). We can set the value of <code>mem_i</code> when it is next used, the <code>if (mem_i != 0)</code>, to the value we want to try out. I assumed that we take the branch since the default was to avoid it (<code>mem_i</code> is set as 0 originally).</p> <p>To put it simply, before <code>tm_min</code> and <code>tm_hour</code> are used, we have to set it to the values we want, and when comparing <code>mem_i</code> with 0 in the <code>if</code>, we have to set it to <code>1</code>. I used Qiling for this task, but there are alternatives as well, such as Frida and GDB Scripting. I did not even need to read the documentation much, as it was very user friendly. Skimming the home page of Qiling and its examples is sufficient.</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">from</span> qiling <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

base <span class="token operator">=</span> <span class="token number">0x555555554000</span> <span class="token comment"># base address of executable, loaded by Qiling when PIE is enabled</span>

<span class="token comment"># These offsets can be found from the binary</span>
printf <span class="token operator">=</span> base <span class="token operator">+</span> <span class="token number">0x01d48</span> 
set_localtime <span class="token operator">=</span> base <span class="token operator">+</span> <span class="token number">0x139b</span>
comparison <span class="token operator">=</span> base <span class="token operator">+</span> <span class="token number">0x174a</span>

<span class="token keyword">for</span> h <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> m <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">def</span> <span class="token function">get_output</span><span class="token punctuation">(</span>ql<span class="token punctuation">:</span> Qiling<span class="token punctuation">)</span><span class="token punctuation">:</span>
            fmt <span class="token operator">=</span> ql<span class="token punctuation">.</span>mem<span class="token punctuation">.</span>string<span class="token punctuation">(</span>ql<span class="token punctuation">.</span>reg<span class="token punctuation">.</span>RDI<span class="token punctuation">)</span>
            inp1 <span class="token operator">=</span> ql<span class="token punctuation">.</span>mem<span class="token punctuation">.</span>string<span class="token punctuation">(</span>ql<span class="token punctuation">.</span>reg<span class="token punctuation">.</span>RSI<span class="token punctuation">)</span>
            out <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span> fmt<span class="token punctuation">,</span> inp1<span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>

        <span class="token keyword">def</span> <span class="token function">set_localtime_fn</span><span class="token punctuation">(</span>q<span class="token punctuation">:</span> Qiling<span class="token punctuation">)</span><span class="token punctuation">:</span>
            tm <span class="token operator">=</span> q<span class="token punctuation">.</span>reg<span class="token punctuation">.</span>RAX <span class="token comment"># output of localtime, the tm struct, is pointed by RAX</span>
            q<span class="token punctuation">.</span>mem<span class="token punctuation">.</span>write<span class="token punctuation">(</span>tm <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> p32<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># &amp;tm + 4 = tm_min</span>
            q<span class="token punctuation">.</span>mem<span class="token punctuation">.</span>write<span class="token punctuation">(</span>tm <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">,</span> p32<span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># &amp;tm + 8 = tm_hour</span>

        <span class="token keyword">def</span> <span class="token function">set_comparison</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">:</span>
            mem_i <span class="token operator">=</span> q<span class="token punctuation">.</span>reg<span class="token punctuation">.</span>RBP<span class="token operator">-</span><span class="token number">0x6b0</span>
            q<span class="token punctuation">.</span>mem<span class="token punctuation">.</span>write<span class="token punctuation">(</span>mem_i<span class="token punctuation">,</span> p32<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        q <span class="token operator">=</span> Qiling<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./soar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rootfs<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> console<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># make it a bit less noisy when console=False</span>

        q<span class="token punctuation">.</span>hook_address<span class="token punctuation">(</span>get_output<span class="token punctuation">,</span> printf<span class="token punctuation">)</span>
        q<span class="token punctuation">.</span>hook_address<span class="token punctuation">(</span>set_localtime_fn<span class="token punctuation">,</span> set_localtime<span class="token punctuation">)</span>
        q<span class="token punctuation">.</span>hook_address<span class="token punctuation">(</span>set_comparison<span class="token punctuation">,</span> comparison<span class="token punctuation">)</span> <span class="token comment"># hooks</span>

        q<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># wheee</span>
</code></pre></div><p>The initial output is as follows:</p> <div class="language- extra-class"><pre class="language-text"><code>[(0, 0), '\n', '']

[(0, 1), '\n', '']

[(0, 2), '\n', '']

[(0, 3), '\n', '']
...
</code></pre></div><p>After a long wait (while I was solving other challenges in the foreground üòÉ), we see this:</p> <div class="language- extra-class"><pre class="language-text"><code>...
[(10, 58), '\n', '']

[(10, 59), '\n', '']

[(11, 0), '%s\n', '4c7b655ed2e3eb42f1d886786c14fe5a757e416f5373de5cd2e4089b870eb5da']
4c7b655ed2e3eb42f1d886786c14fe5a757e416f5373de5cd2e4089b870eb5da
[(11, 1), '%s\n', '4c7b655ed2e3eb42f1d886786c14fe5a757e416f5373de5cd2e4089b870eb5da']
4c7b655ed2e3eb42f1d886786c14fe5a757e416f5373de5cd2e4089b870eb5da
...
</code></pre></div><p>Huzzah!</p> <h2 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h2> <p>This probably was not the intended solution, but I was short on time. Luckily the script needed very little debugging, and I managed to get valid outputs on my first few tries. Overall, I am quite amazed with Qiling and it's ability to isolate and emulate binaries, and even provide a high level of introspection.</p> <p>I did manage to know what the 'intended' solution was, which was to download a file from DSO's site, <a href="https://www.dso.org.sg/Media/Default/pdf/SOAR%20Insert.pdf" target="_blank" rel="noopener noreferrer">https://www.dso.org.sg/Media/Default/pdf/SOAR%20Insert.pdf<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (this PDF is actually referenced in an unused function that I did not notice), which was the file that we checked the size for, then bruteforcing <code>tm_min</code> (<code>tm_hour</code> doesn't even matter!).</p> <p>Or download the file, then wait for noon üòÇ</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> <!----></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c3d8ca62.js" defer></script><script src="/assets/js/6.3722ae10.js" defer></script><script src="/assets/js/3.8eed2eee.js" defer></script><script src="/assets/js/20.00359bb3.js" defer></script>
  </body>
</html>
